#!/bin/bash

sdir=$(dirname "$0")
ntwk="irc.freenode.net"
port="6667"
nick="arthurtest"

main() {
	# Create input pipe
	if [ ! -p "$sdir/in" ] ; then
		mkfifo $sdir/in
	fi

	./bin/sic -h "$ntwk" -p "$port" -n "$nick" <> $sdir/in |
	while read line; do
		echo "$line $(echo $line | awk '{print $5}')"
		if [ $(echo "$line" | awk '{print $5}') = "376" ] ; then
			join_channels
		fi
	done
}

function join_channels() {

	cat $sdir/channels |
	while read line; do
		echo ":j $line" > $sdir/in
	done

}

main
